var be=Object.defineProperty;var Tt=t=>{throw TypeError(t)};var je=(t,e,r)=>e in t?be(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var d=(t,e,r)=>je(t,typeof e!="symbol"?e+"":e,r),Dt=(t,e,r)=>e.has(t)||Tt("Cannot "+r);var n=(t,e,r)=>(Dt(t,e,"read from private field"),r?r.call(t):e.get(t)),p=(t,e,r)=>e.has(t)?Tt("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),f=(t,e,r,s)=>(Dt(t,e,"write to private field"),s?s.call(t,r):e.set(t,r),r),g=(t,e,r)=>(Dt(t,e,"access private method"),r);var kt=(t,e,r,s)=>({set _(i){f(t,e,i,r)},get _(){return n(t,e,s)}});import{jsxs as Ut,jsx as nt}from"react/jsx-runtime";import{renderToString as Pe}from"react-dom/server";var Kt=(t,e,r)=>(s,i)=>{let o=-1;return a(0);async function a(l){if(l<=o)throw new Error("next() called multiple times");o=l;let c,h=!1,u;if(t[l]?(u=t[l][0][0],s.req.routeIndex=l):u=l===t.length&&i||void 0,u)try{c=await u(s,()=>a(l+1))}catch(w){if(w instanceof Error&&e)s.error=w,c=await e(w,s),h=!0;else throw w}else s.finalized===!1&&r&&(c=await r(s));return c&&(s.finalized===!1||h)&&(s.res=c),s}},Se=async(t,e=Object.create(null))=>{const{all:r=!1,dot:s=!1}=e,o=(t instanceof ae?t.raw.headers:t.headers).get("Content-Type");return o!=null&&o.startsWith("multipart/form-data")||o!=null&&o.startsWith("application/x-www-form-urlencoded")?Ae(t,{all:r,dot:s}):{}};async function Ae(t,e){const r=await t.formData();return r?$e(r,e):{}}function $e(t,e){const r=Object.create(null);return t.forEach((s,i)=>{e.all||i.endsWith("[]")?He(r,i,s):r[i]=s}),e.dot&&Object.entries(r).forEach(([s,i])=>{s.includes(".")&&(Ce(r,s,i),delete r[s])}),r}var He=(t,e,r)=>{t[e]!==void 0?Array.isArray(t[e])?t[e].push(r):t[e]=[t[e],r]:t[e]=r},Ce=(t,e,r)=>{let s=t;const i=e.split(".");i.forEach((o,a)=>{a===i.length-1?s[o]=r:((!s[o]||typeof s[o]!="object"||Array.isArray(s[o])||s[o]instanceof File)&&(s[o]=Object.create(null)),s=s[o])})},re=t=>{const e=t.split("/");return e[0]===""&&e.shift(),e},De=t=>{const{groups:e,path:r}=Le(t),s=re(r);return _e(s,e)},Le=t=>{const e=[];return t=t.replace(/\{[^}]+\}/g,(r,s)=>{const i=`@${s}`;return e.push([i,r]),i}),{groups:e,path:t}},_e=(t,e)=>{for(let r=e.length-1;r>=0;r--){const[s]=e[r];for(let i=t.length-1;i>=0;i--)if(t[i].includes(s)){t[i]=t[i].replace(s,e[r][1]);break}}return t},bt={},Bt=(t,e)=>{if(t==="*")return"*";const r=t.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(r){const s=`${t}#${e}`;return bt[s]||(r[2]?bt[s]=e&&e[0]!==":"&&e[0]!=="*"?[s,r[1],new RegExp(`^${r[2]}(?=/${e})`)]:[t,r[1],new RegExp(`^${r[2]}$`)]:bt[s]=[t,r[1],!0]),bt[s]}return null},se=(t,e)=>{try{return e(t)}catch{return t.replace(/(?:%[0-9A-Fa-f]{2})+/g,r=>{try{return e(r)}catch{return r}})}},Ie=t=>se(t,decodeURI),ne=t=>{const e=t.url,r=e.indexOf("/",8);let s=r;for(;s<e.length;s++){const i=e.charCodeAt(s);if(i===37){const o=e.indexOf("?",s),a=e.slice(r,o===-1?void 0:o);return Ie(a.includes("%25")?a.replace(/%25/g,"%2525"):a)}else if(i===63)break}return e.slice(r,s)},Ne=t=>{const e=ne(t);return e.length>1&&e.at(-1)==="/"?e.slice(0,-1):e},ot=(t,e,...r)=>(r.length&&(e=ot(e,...r)),`${(t==null?void 0:t[0])==="/"?"":"/"}${t}${e==="/"?"":`${(t==null?void 0:t.at(-1))==="/"?"":"/"}${(e==null?void 0:e[0])==="/"?e.slice(1):e}`}`),ie=t=>{if(!t.match(/\:.+\?$/))return null;const e=t.split("/"),r=[];let s="";return e.forEach(i=>{if(i!==""&&!/\:/.test(i))s+="/"+i;else if(/\:/.test(i))if(/\?/.test(i)){r.length===0&&s===""?r.push("/"):r.push(s);const o=i.replace("?","");s+="/"+o,r.push(s)}else s+="/"+i}),r.filter((i,o,a)=>a.indexOf(i)===o)},Lt=t=>/[%+]/.test(t)?(t.indexOf("+")!==-1&&(t=t.replace(/\+/g," ")),t.indexOf("%")!==-1?ce(t):t):t,oe=(t,e,r)=>{let s;if(!r&&e&&!/[%+]/.test(e)){let a=t.indexOf(`?${e}`,8);for(a===-1&&(a=t.indexOf(`&${e}`,8));a!==-1;){const l=t.charCodeAt(a+e.length+1);if(l===61){const c=a+e.length+2,h=t.indexOf("&",c);return Lt(t.slice(c,h===-1?void 0:h))}else if(l==38||isNaN(l))return"";a=t.indexOf(`&${e}`,a+1)}if(s=/[%+]/.test(t),!s)return}const i={};s??(s=/[%+]/.test(t));let o=t.indexOf("?",8);for(;o!==-1;){const a=t.indexOf("&",o+1);let l=t.indexOf("=",o);l>a&&a!==-1&&(l=-1);let c=t.slice(o+1,l===-1?a===-1?void 0:a:l);if(s&&(c=Lt(c)),o=a,c==="")continue;let h;l===-1?h="":(h=t.slice(l+1,a===-1?void 0:a),s&&(h=Lt(h))),r?(i[c]&&Array.isArray(i[c])||(i[c]=[]),i[c].push(h)):i[c]??(i[c]=h)}return e?i[e]:i},Me=oe,Fe=(t,e)=>oe(t,e,!0),ce=decodeURIComponent,Wt=t=>se(t,ce),ct,C,B,he,le,It,q,Vt,ae=(Vt=class{constructor(t,e="/",r=[[]]){p(this,B);d(this,"raw");p(this,ct);p(this,C);d(this,"routeIndex",0);d(this,"path");d(this,"bodyCache",{});p(this,q,t=>{const{bodyCache:e,raw:r}=this,s=e[t];if(s)return s;const i=Object.keys(e)[0];return i?e[i].then(o=>(i==="json"&&(o=JSON.stringify(o)),new Response(o)[t]())):e[t]=r[t]()});this.raw=t,this.path=e,f(this,C,r),f(this,ct,{})}param(t){return t?g(this,B,he).call(this,t):g(this,B,le).call(this)}query(t){return Me(this.url,t)}queries(t){return Fe(this.url,t)}header(t){if(t)return this.raw.headers.get(t)??void 0;const e={};return this.raw.headers.forEach((r,s)=>{e[s]=r}),e}async parseBody(t){var e;return(e=this.bodyCache).parsedBody??(e.parsedBody=await Se(this,t))}json(){return n(this,q).call(this,"json")}text(){return n(this,q).call(this,"text")}arrayBuffer(){return n(this,q).call(this,"arrayBuffer")}blob(){return n(this,q).call(this,"blob")}formData(){return n(this,q).call(this,"formData")}addValidatedData(t,e){n(this,ct)[t]=e}valid(t){return n(this,ct)[t]}get url(){return this.raw.url}get method(){return this.raw.method}get matchedRoutes(){return n(this,C)[0].map(([[,t]])=>t)}get routePath(){return n(this,C)[0].map(([[,t]])=>t)[this.routeIndex].path}},ct=new WeakMap,C=new WeakMap,B=new WeakSet,he=function(t){const e=n(this,C)[0][this.routeIndex][1][t],r=g(this,B,It).call(this,e);return r?/\%/.test(r)?Wt(r):r:void 0},le=function(){const t={},e=Object.keys(n(this,C)[0][this.routeIndex][1]);for(const r of e){const s=g(this,B,It).call(this,n(this,C)[0][this.routeIndex][1][r]);s&&typeof s=="string"&&(t[r]=/\%/.test(s)?Wt(s):s)}return t},It=function(t){return n(this,C)[1]?n(this,C)[1][t]:t},q=new WeakMap,Vt),Te={Stringify:1},ue=async(t,e,r,s,i)=>{typeof t=="object"&&!(t instanceof String)&&(t instanceof Promise||(t=t.toString()),t instanceof Promise&&(t=await t));const o=t.callbacks;return o!=null&&o.length?(i?i[0]+=t:i=[t],Promise.all(o.map(l=>l({phase:e,buffer:i,context:s}))).then(l=>Promise.all(l.filter(Boolean).map(c=>ue(c,e,!1,s,i))).then(()=>i[0]))):Promise.resolve(t)},ke="text/plain; charset=UTF-8",_t=(t,e={})=>{for(const r of Object.keys(e))t.set(r,e[r]);return t},yt,vt,M,Q,F,v,m,I,T,Rt,at,ht,mt,xt,S,H,Gt,Ue=(Gt=class{constructor(t,e){p(this,S);p(this,yt);p(this,vt);d(this,"env",{});p(this,M);d(this,"finalized",!1);d(this,"error");p(this,Q,200);p(this,F);p(this,v);p(this,m);p(this,I);p(this,T,!0);p(this,Rt);p(this,at);p(this,ht);p(this,mt);p(this,xt);d(this,"render",(...t)=>(n(this,at)??f(this,at,e=>this.html(e)),n(this,at).call(this,...t)));d(this,"setLayout",t=>f(this,Rt,t));d(this,"getLayout",()=>n(this,Rt));d(this,"setRenderer",t=>{f(this,at,t)});d(this,"header",(t,e,r)=>{if(e===void 0){n(this,v)?n(this,v).delete(t):n(this,m)&&delete n(this,m)[t.toLocaleLowerCase()],this.finalized&&this.res.headers.delete(t);return}r!=null&&r.append?(n(this,v)||(f(this,T,!1),f(this,v,new Headers(n(this,m))),f(this,m,{})),n(this,v).append(t,e)):n(this,v)?n(this,v).set(t,e):(n(this,m)??f(this,m,{}),n(this,m)[t.toLowerCase()]=e),this.finalized&&(r!=null&&r.append?this.res.headers.append(t,e):this.res.headers.set(t,e))});d(this,"status",t=>{f(this,T,!1),f(this,Q,t)});d(this,"set",(t,e)=>{n(this,M)??f(this,M,new Map),n(this,M).set(t,e)});d(this,"get",t=>n(this,M)?n(this,M).get(t):void 0);d(this,"newResponse",(...t)=>g(this,S,H).call(this,...t));d(this,"body",(t,e,r)=>typeof e=="number"?g(this,S,H).call(this,t,e,r):g(this,S,H).call(this,t,e));d(this,"text",(t,e,r)=>{if(!n(this,m)){if(n(this,T)&&!r&&!e)return new Response(t);f(this,m,{})}return n(this,m)["content-type"]=ke,typeof e=="number"?g(this,S,H).call(this,t,e,r):g(this,S,H).call(this,t,e)});d(this,"json",(t,e,r)=>{const s=JSON.stringify(t);return n(this,m)??f(this,m,{}),n(this,m)["content-type"]="application/json",typeof e=="number"?g(this,S,H).call(this,s,e,r):g(this,S,H).call(this,s,e)});d(this,"html",(t,e,r)=>(n(this,m)??f(this,m,{}),n(this,m)["content-type"]="text/html; charset=UTF-8",typeof t=="object"?ue(t,Te.Stringify,!1,{}).then(s=>typeof e=="number"?g(this,S,H).call(this,s,e,r):g(this,S,H).call(this,s,e)):typeof e=="number"?g(this,S,H).call(this,t,e,r):g(this,S,H).call(this,t,e)));d(this,"redirect",(t,e)=>(n(this,v)??f(this,v,new Headers),n(this,v).set("Location",String(t)),this.newResponse(null,e??302)));d(this,"notFound",()=>(n(this,ht)??f(this,ht,()=>new Response),n(this,ht).call(this,this)));f(this,yt,t),e&&(f(this,F,e.executionCtx),this.env=e.env,f(this,ht,e.notFoundHandler),f(this,xt,e.path),f(this,mt,e.matchResult))}get req(){return n(this,vt)??f(this,vt,new ae(n(this,yt),n(this,xt),n(this,mt))),n(this,vt)}get event(){if(n(this,F)&&"respondWith"in n(this,F))return n(this,F);throw Error("This context has no FetchEvent")}get executionCtx(){if(n(this,F))return n(this,F);throw Error("This context has no ExecutionContext")}get res(){return f(this,T,!1),n(this,I)||f(this,I,new Response("404 Not Found",{status:404}))}set res(t){if(f(this,T,!1),n(this,I)&&t)try{for(const[e,r]of n(this,I).headers.entries())if(e!=="content-type")if(e==="set-cookie"){const s=n(this,I).headers.getSetCookie();t.headers.delete("set-cookie");for(const i of s)t.headers.append("set-cookie",i)}else t.headers.set(e,r)}catch(e){if(e instanceof TypeError&&e.message.includes("immutable")){this.res=new Response(t.body,{headers:t.headers,status:t.status});return}else throw e}f(this,I,t),this.finalized=!0}get var(){return n(this,M)?Object.fromEntries(n(this,M)):{}}},yt=new WeakMap,vt=new WeakMap,M=new WeakMap,Q=new WeakMap,F=new WeakMap,v=new WeakMap,m=new WeakMap,I=new WeakMap,T=new WeakMap,Rt=new WeakMap,at=new WeakMap,ht=new WeakMap,mt=new WeakMap,xt=new WeakMap,S=new WeakSet,H=function(t,e,r){if(n(this,T)&&!r&&!e&&n(this,Q)===200)return new Response(t,{headers:n(this,m)});if(e&&typeof e!="number"){const i=new Headers(e.headers);n(this,v)&&n(this,v).forEach((a,l)=>{l==="set-cookie"?i.append(l,a):i.set(l,a)});const o=_t(i,n(this,m));return new Response(t,{headers:o,status:e.status??n(this,Q)})}const s=typeof e=="number"?e:n(this,Q);n(this,m)??f(this,m,{}),n(this,v)??f(this,v,new Headers),_t(n(this,v),n(this,m)),n(this,I)&&(n(this,I).headers.forEach((i,o)=>{var a,l;o==="set-cookie"?(a=n(this,v))==null||a.append(o,i):(l=n(this,v))==null||l.set(o,i)}),_t(n(this,v),n(this,m))),r??(r={});for(const[i,o]of Object.entries(r))if(typeof o=="string")n(this,v).set(i,o);else{n(this,v).delete(i);for(const a of o)n(this,v).append(i,a)}return new Response(t,{status:s,headers:n(this,v)})},Gt),x="ALL",Ke="all",Be=["get","post","put","delete","options","patch"],fe="Can not add a route since the matcher is already built.",de=class extends Error{},We="__COMPOSED_HANDLER",qe=t=>t.text("404 Not Found",404),qt=(t,e)=>"getResponse"in t?t.getResponse():(console.error(t),e.text("Internal Server Error",500)),D,E,ge,k,Y,jt,Pt,Xt,pe=(Xt=class{constructor(e={}){p(this,E);d(this,"get");d(this,"post");d(this,"put");d(this,"delete");d(this,"options");d(this,"patch");d(this,"all");d(this,"on");d(this,"use");d(this,"router");d(this,"getPath");d(this,"_basePath","/");p(this,D,"/");d(this,"routes",[]);p(this,k,qe);d(this,"errorHandler",qt);d(this,"onError",e=>(this.errorHandler=e,this));d(this,"notFound",e=>(f(this,k,e),this));d(this,"fetch",(e,...r)=>g(this,E,Pt).call(this,e,r[1],r[0],e.method));d(this,"request",(e,r,s,i)=>e instanceof Request?this.fetch(r?new Request(e,r):e,s,i):(e=e.toString(),this.fetch(new Request(/^https?:\/\//.test(e)?e:`http://localhost${ot("/",e)}`,r),s,i)));d(this,"fire",()=>{addEventListener("fetch",e=>{e.respondWith(g(this,E,Pt).call(this,e.request,e,void 0,e.request.method))})});[...Be,Ke].forEach(i=>{this[i]=(o,...a)=>(typeof o=="string"?f(this,D,o):g(this,E,Y).call(this,i,n(this,D),o),a.forEach(l=>{g(this,E,Y).call(this,i,n(this,D),l)}),this)}),this.on=(i,o,...a)=>{for(const l of[o].flat()){f(this,D,l);for(const c of[i].flat())a.map(h=>{g(this,E,Y).call(this,c.toUpperCase(),n(this,D),h)})}return this},this.use=(i,...o)=>(typeof i=="string"?f(this,D,i):(f(this,D,"*"),o.unshift(i)),o.forEach(a=>{g(this,E,Y).call(this,x,n(this,D),a)}),this);const s=e.strict??!0;delete e.strict,Object.assign(this,e),this.getPath=s?e.getPath??ne:Ne}route(e,r){const s=this.basePath(e);return r.routes.map(i=>{var a;let o;r.errorHandler===qt?o=i.handler:(o=async(l,c)=>(await Kt([],r.errorHandler)(l,()=>i.handler(l,c))).res,o[We]=i.handler),g(a=s,E,Y).call(a,i.method,i.path,o)}),this}basePath(e){const r=g(this,E,ge).call(this);return r._basePath=ot(this._basePath,e),r}mount(e,r,s){let i,o;s&&(typeof s=="function"?o=s:(o=s.optionHandler,i=s.replaceRequest));const a=o?c=>{const h=o(c);return Array.isArray(h)?h:[h]}:c=>{let h;try{h=c.executionCtx}catch{}return[c.env,h]};i||(i=(()=>{const c=ot(this._basePath,e),h=c==="/"?0:c.length;return u=>{const w=new URL(u.url);return w.pathname=w.pathname.slice(h)||"/",new Request(w,u)}})());const l=async(c,h)=>{const u=await r(i(c.req.raw),...a(c));if(u)return u;await h()};return g(this,E,Y).call(this,x,ot(e,"*"),l),this}},D=new WeakMap,E=new WeakSet,ge=function(){const e=new pe({router:this.router,getPath:this.getPath});return e.routes=this.routes,e},k=new WeakMap,Y=function(e,r,s){e=e.toUpperCase(),r=ot(this._basePath,r);const i={path:r,method:e,handler:s};this.router.add(e,r,[s,i]),this.routes.push(i)},jt=function(e,r){if(e instanceof Error)return this.errorHandler(e,r);throw e},Pt=function(e,r,s,i){if(i==="HEAD")return(async()=>new Response(null,await g(this,E,Pt).call(this,e,r,s,"GET")))();const o=this.getPath(e,{env:s}),a=this.router.match(i,o),l=new Ue(e,{path:o,matchResult:a,env:s,executionCtx:r,notFoundHandler:n(this,k)});if(a[0].length===1){let h;try{h=a[0][0][0][0](l,async()=>{l.res=await n(this,k).call(this,l)})}catch(u){return g(this,E,jt).call(this,u,l)}return h instanceof Promise?h.then(u=>u||(l.finalized?l.res:n(this,k).call(this,l))).catch(u=>g(this,E,jt).call(this,u,l)):h??n(this,k).call(this,l)}const c=Kt(a[0],this.errorHandler,n(this,k));return(async()=>{try{const h=await c(l);if(!h.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return h.res}catch(h){return g(this,E,jt).call(this,h,l)}})()},Xt),At="[^/]+",gt=".*",wt="(?:|/.*)",pt=Symbol(),ze=new Set(".\\+*[^]$()");function Ve(t,e){return t.length===1?e.length===1?t<e?-1:1:-1:e.length===1||t===gt||t===wt?1:e===gt||e===wt?-1:t===At?1:e===At?-1:t.length===e.length?t<e?-1:1:e.length-t.length}var Z,tt,L,Yt,Nt=(Yt=class{constructor(){p(this,Z);p(this,tt);p(this,L,Object.create(null))}insert(e,r,s,i,o){if(e.length===0){if(n(this,Z)!==void 0)throw pt;if(o)return;f(this,Z,r);return}const[a,...l]=e,c=a==="*"?l.length===0?["","",gt]:["","",At]:a==="/*"?["","",wt]:a.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);let h;if(c){const u=c[1];let w=c[2]||At;if(u&&c[2]&&(w=w.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(w)))throw pt;if(h=n(this,L)[w],!h){if(Object.keys(n(this,L)).some(y=>y!==gt&&y!==wt))throw pt;if(o)return;h=n(this,L)[w]=new Nt,u!==""&&f(h,tt,i.varIndex++)}!o&&u!==""&&s.push([u,n(h,tt)])}else if(h=n(this,L)[a],!h){if(Object.keys(n(this,L)).some(u=>u.length>1&&u!==gt&&u!==wt))throw pt;if(o)return;h=n(this,L)[a]=new Nt}h.insert(l,r,s,i,o)}buildRegExpStr(){const r=Object.keys(n(this,L)).sort(Ve).map(s=>{const i=n(this,L)[s];return(typeof n(i,tt)=="number"?`(${s})@${n(i,tt)}`:ze.has(s)?`\\${s}`:s)+i.buildRegExpStr()});return typeof n(this,Z)=="number"&&r.unshift(`#${n(this,Z)}`),r.length===0?"":r.length===1?r[0]:"(?:"+r.join("|")+")"}},Z=new WeakMap,tt=new WeakMap,L=new WeakMap,Yt),$t,Et,Jt,Ge=(Jt=class{constructor(){p(this,$t,{varIndex:0});p(this,Et,new Nt)}insert(t,e,r){const s=[],i=[];for(let a=0;;){let l=!1;if(t=t.replace(/\{[^}]+\}/g,c=>{const h=`@\\${a}`;return i[a]=[h,c],a++,l=!0,h}),!l)break}const o=t.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let a=i.length-1;a>=0;a--){const[l]=i[a];for(let c=o.length-1;c>=0;c--)if(o[c].indexOf(l)!==-1){o[c]=o[c].replace(l,i[a][1]);break}}return n(this,Et).insert(o,e,s,n(this,$t),r),s}buildRegExp(){let t=n(this,Et).buildRegExpStr();if(t==="")return[/^$/,[],[]];let e=0;const r=[],s=[];return t=t.replace(/#(\d+)|@(\d+)|\.\*\$/g,(i,o,a)=>o!==void 0?(r[++e]=Number(o),"$()"):(a!==void 0&&(s[Number(a)]=++e),"")),[new RegExp(`^${t}`),r,s]}},$t=new WeakMap,Et=new WeakMap,Jt),we=[],Xe=[/^$/,[],Object.create(null)],St=Object.create(null);function ye(t){return St[t]??(St[t]=new RegExp(t==="*"?"":`^${t.replace(/\/\*$|([.\\+*[^\]$()])/g,(e,r)=>r?`\\${r}`:"(?:|/.*)")}$`))}function Ye(){St=Object.create(null)}function Je(t){var h;const e=new Ge,r=[];if(t.length===0)return Xe;const s=t.map(u=>[!/\*|\/:/.test(u[0]),...u]).sort(([u,w],[y,O])=>u?1:y?-1:w.length-O.length),i=Object.create(null);for(let u=0,w=-1,y=s.length;u<y;u++){const[O,A,R]=s[u];O?i[A]=[R.map(([$])=>[$,Object.create(null)]),we]:w++;let P;try{P=e.insert(A,w,O)}catch($){throw $===pt?new de(A):$}O||(r[w]=R.map(([$,st])=>{const ft=Object.create(null);for(st-=1;st>=0;st--){const[_,Ht]=P[st];ft[_]=Ht}return[$,ft]}))}const[o,a,l]=e.buildRegExp();for(let u=0,w=r.length;u<w;u++)for(let y=0,O=r[u].length;y<O;y++){const A=(h=r[u][y])==null?void 0:h[1];if(!A)continue;const R=Object.keys(A);for(let P=0,$=R.length;P<$;P++)A[R[P]]=l[A[R[P]]]}const c=[];for(const u in a)c[u]=r[a[u]];return[o,c,i]}function it(t,e){if(t){for(const r of Object.keys(t).sort((s,i)=>i.length-s.length))if(ye(r).test(e))return[...t[r]]}}var z,V,ut,ve,Re,Qt,Qe=(Qt=class{constructor(){p(this,ut);d(this,"name","RegExpRouter");p(this,z);p(this,V);f(this,z,{[x]:Object.create(null)}),f(this,V,{[x]:Object.create(null)})}add(t,e,r){var l;const s=n(this,z),i=n(this,V);if(!s||!i)throw new Error(fe);s[t]||[s,i].forEach(c=>{c[t]=Object.create(null),Object.keys(c[x]).forEach(h=>{c[t][h]=[...c[x][h]]})}),e==="/*"&&(e="*");const o=(e.match(/\/:/g)||[]).length;if(/\*$/.test(e)){const c=ye(e);t===x?Object.keys(s).forEach(h=>{var u;(u=s[h])[e]||(u[e]=it(s[h],e)||it(s[x],e)||[])}):(l=s[t])[e]||(l[e]=it(s[t],e)||it(s[x],e)||[]),Object.keys(s).forEach(h=>{(t===x||t===h)&&Object.keys(s[h]).forEach(u=>{c.test(u)&&s[h][u].push([r,o])})}),Object.keys(i).forEach(h=>{(t===x||t===h)&&Object.keys(i[h]).forEach(u=>c.test(u)&&i[h][u].push([r,o]))});return}const a=ie(e)||[e];for(let c=0,h=a.length;c<h;c++){const u=a[c];Object.keys(i).forEach(w=>{var y;(t===x||t===w)&&((y=i[w])[u]||(y[u]=[...it(s[w],u)||it(s[x],u)||[]]),i[w][u].push([r,o-h+c+1]))})}}match(t,e){Ye();const r=g(this,ut,ve).call(this);return this.match=(s,i)=>{const o=r[s]||r[x],a=o[2][i];if(a)return a;const l=i.match(o[0]);if(!l)return[[],we];const c=l.indexOf("",1);return[o[1][c],l]},this.match(t,e)}},z=new WeakMap,V=new WeakMap,ut=new WeakSet,ve=function(){const t=Object.create(null);return Object.keys(n(this,V)).concat(Object.keys(n(this,z))).forEach(e=>{t[e]||(t[e]=g(this,ut,Re).call(this,e))}),f(this,z,f(this,V,void 0)),t},Re=function(t){const e=[];let r=t===x;return[n(this,z),n(this,V)].forEach(s=>{const i=s[t]?Object.keys(s[t]).map(o=>[o,s[t][o]]):[];i.length!==0?(r||(r=!0),e.push(...i)):t!==x&&e.push(...Object.keys(s[x]).map(o=>[o,s[x][o]]))}),r?Je(e):null},Qt),G,U,Zt,Ze=(Zt=class{constructor(t){d(this,"name","SmartRouter");p(this,G,[]);p(this,U,[]);f(this,G,t.routers)}add(t,e,r){if(!n(this,U))throw new Error(fe);n(this,U).push([t,e,r])}match(t,e){if(!n(this,U))throw new Error("Fatal error");const r=n(this,G),s=n(this,U),i=r.length;let o=0,a;for(;o<i;o++){const l=r[o];try{for(let c=0,h=s.length;c<h;c++)l.add(...s[c]);a=l.match(t,e)}catch(c){if(c instanceof de)continue;throw c}this.match=l.match.bind(l),f(this,G,[l]),f(this,U,void 0);break}if(o===i)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,a}get activeRouter(){if(n(this,U)||n(this,G).length!==1)throw new Error("No active router has been determined yet.");return n(this,G)[0]}},G=new WeakMap,U=new WeakMap,Zt),dt=Object.create(null),X,j,et,lt,b,K,J,te,me=(te=class{constructor(t,e,r){p(this,K);p(this,X);p(this,j);p(this,et);p(this,lt,0);p(this,b,dt);if(f(this,j,r||Object.create(null)),f(this,X,[]),t&&e){const s=Object.create(null);s[t]={handler:e,possibleKeys:[],score:0},f(this,X,[s])}f(this,et,[])}insert(t,e,r){f(this,lt,++kt(this,lt)._);let s=this;const i=De(e),o=[];for(let c=0,h=i.length;c<h;c++){const u=i[c],w=i[c+1],y=Bt(u,w),O=Array.isArray(y)?y[0]:u;if(Object.keys(n(s,j)).includes(O)){s=n(s,j)[O];const A=Bt(u,w);A&&o.push(A[1]);continue}n(s,j)[O]=new me,y&&(n(s,et).push(y),o.push(y[1])),s=n(s,j)[O]}const a=Object.create(null),l={handler:r,possibleKeys:o.filter((c,h,u)=>u.indexOf(c)===h),score:n(this,lt)};return a[t]=l,n(s,X).push(a),s}search(t,e){var l;const r=[];f(this,b,dt);let i=[this];const o=re(e),a=[];for(let c=0,h=o.length;c<h;c++){const u=o[c],w=c===h-1,y=[];for(let O=0,A=i.length;O<A;O++){const R=i[O],P=n(R,j)[u];P&&(f(P,b,n(R,b)),w?(n(P,j)["*"]&&r.push(...g(this,K,J).call(this,n(P,j)["*"],t,n(R,b))),r.push(...g(this,K,J).call(this,P,t,n(R,b)))):y.push(P));for(let $=0,st=n(R,et).length;$<st;$++){const ft=n(R,et)[$],_=n(R,b)===dt?{}:{...n(R,b)};if(ft==="*"){const W=n(R,j)["*"];W&&(r.push(...g(this,K,J).call(this,W,t,n(R,b))),f(W,b,_),y.push(W));continue}if(u==="")continue;const[Ht,Ft,Ot]=ft,N=n(R,j)[Ht],Oe=o.slice(c).join("/");if(Ot instanceof RegExp){const W=Ot.exec(Oe);if(W){if(_[Ft]=W[0],r.push(...g(this,K,J).call(this,N,t,n(R,b),_)),Object.keys(n(N,j)).length){f(N,b,_);const Ct=((l=W[0].match(/\//))==null?void 0:l.length)??0;(a[Ct]||(a[Ct]=[])).push(N)}continue}}(Ot===!0||Ot.test(u))&&(_[Ft]=u,w?(r.push(...g(this,K,J).call(this,N,t,_,n(R,b))),n(N,j)["*"]&&r.push(...g(this,K,J).call(this,n(N,j)["*"],t,_,n(R,b)))):(f(N,b,_),y.push(N)))}}i=y.concat(a.shift()??[])}return r.length>1&&r.sort((c,h)=>c.score-h.score),[r.map(({handler:c,params:h})=>[c,h])]}},X=new WeakMap,j=new WeakMap,et=new WeakMap,lt=new WeakMap,b=new WeakMap,K=new WeakSet,J=function(t,e,r,s){const i=[];for(let o=0,a=n(t,X).length;o<a;o++){const l=n(t,X)[o],c=l[e]||l[x],h={};if(c!==void 0&&(c.params=Object.create(null),i.push(c),r!==dt||s&&s!==dt))for(let u=0,w=c.possibleKeys.length;u<w;u++){const y=c.possibleKeys[u],O=h[c.score];c.params[y]=s!=null&&s[y]&&!O?s[y]:r[y]??(s==null?void 0:s[y]),h[c.score]=!0}}return i},te),rt,ee,tr=(ee=class{constructor(){d(this,"name","TrieRouter");p(this,rt);f(this,rt,new me)}add(t,e,r){const s=ie(e);if(s){for(let i=0,o=s.length;i<o;i++)n(this,rt).insert(t,s[i],r);return}n(this,rt).insert(t,e,r)}match(t,e){return n(this,rt).search(t,e)}},rt=new WeakMap,ee),xe=class extends pe{constructor(t={}){super(t),this.router=t.router??new Ze({routers:[new Qe,new tr]})}};const Mt=new xe;Mt.get("/api/clock",t=>t.json({var:t.env.MY_VAR,time:new Date().toLocaleTimeString()}));Mt.get("*",t=>t.html(Pe(Ut("html",{children:[Ut("head",{children:[nt("meta",{charSet:"utf-8"}),nt("meta",{content:"width=device-width, initial-scale=1",name:"viewport"}),nt("link",{rel:"stylesheet",href:"https://cdn.simplecss.org/simple.min.css"}),nt("script",{type:"module",src:"/static/client.js"})]}),nt("body",{children:nt("div",{id:"root"})})]}))));const zt=new xe,er=Object.assign({"/src/index.tsx":Mt});let Ee=!1;for(const[,t]of Object.entries(er))t&&(zt.route("/",t),zt.notFound(e=>{let r;try{r=e.executionCtx}catch{}return t.fetch(e.req.raw,e.env,r)}),Ee=!0);if(!Ee)throw new Error("Can't import modules from ['/src/index.ts','/src/index.tsx','/app/server.ts']");export{zt as default};
